\hypertarget{gquad_8h_source}{}\section{gquad.\+h}
\label{gquad_8h_source}\index{Vienna\+R\+N\+A/gquad.\+h@{Vienna\+R\+N\+A/gquad.\+h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00002 \textcolor{preprocessor}{#define VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00003 
00004 \textcolor{preprocessor}{#include <\hyperlink{data__structures_8h}{ViennaRNA/data\_structures.h}>}
00005 \textcolor{preprocessor}{#include <\hyperlink{params_8h}{ViennaRNA/params.h}>}
00006 
00007 \textcolor{preprocessor}{#ifndef INLINE}
00008 \textcolor{preprocessor}{#ifdef \_\_GNUC\_\_}
00009 \textcolor{preprocessor}{# define INLINE inline}
00010 \textcolor{preprocessor}{#else}
00011 \textcolor{preprocessor}{# define INLINE}
00012 \textcolor{preprocessor}{#endif}
00013 \textcolor{preprocessor}{#endif}
00014 
00025 \textcolor{keywordtype}{int}         E\_gquad(\textcolor{keywordtype}{int} L,
00026                     \textcolor{keywordtype}{int} l[3],
00027                     \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00028 
00029 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} exp\_E\_gquad( \textcolor{keywordtype}{int} L,
00030                         \textcolor{keywordtype}{int} l[3],
00031                         \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00032 
00033 \textcolor{keywordtype}{int}         E\_gquad\_ali(\textcolor{keywordtype}{int} i,
00034                         \textcolor{keywordtype}{int} L,
00035                         \textcolor{keywordtype}{int} l[3],
00036                         \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00037                         \textcolor{keywordtype}{int} n\_seq,
00038                         \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00039 
00040 
00041 \textcolor{keywordtype}{void}        E\_gquad\_ali\_en( \textcolor{keywordtype}{int} i,
00042                             \textcolor{keywordtype}{int} L,
00043                             \textcolor{keywordtype}{int} l[3],
00044                             \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00045                             \textcolor{keywordtype}{int} n\_seq,
00046                             \textcolor{keywordtype}{int} en[2],
00047                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00048 
00065 \textcolor{keywordtype}{int}         *\hyperlink{group__loops_ga392e45c9615aa123737671603fa4203c}{get\_gquad\_matrix}(\textcolor{keywordtype}{short} *S, \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00066 
00067 \textcolor{keywordtype}{int}         *get\_gquad\_ali\_matrix(\textcolor{keywordtype}{short} *S\_cons,
00068                                   \textcolor{keywordtype}{short} **S,
00069                                   \textcolor{keywordtype}{int} n\_seq,
00070                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00071 
00072 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  *get\_gquad\_pf\_matrix( \textcolor{keywordtype}{short} *S,
00073                                   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00074                                   \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00075 
00076 \textcolor{keywordtype}{int}         **get\_gquad\_L\_matrix( \textcolor{keywordtype}{short} *S,
00077                                   \textcolor{keywordtype}{int} start,
00078                                   \textcolor{keywordtype}{int} maxdist,
00079                                   \textcolor{keywordtype}{int} **g,
00080                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00081 
00082 \textcolor{keywordtype}{void}        vrna\_gquad\_mx\_local\_update( \hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00083                                         \textcolor{keywordtype}{int} start);
00084 
00085 \textcolor{keywordtype}{void}        get\_gquad\_pattern\_mfe(\textcolor{keywordtype}{short} *S,
00086                                   \textcolor{keywordtype}{int} i,
00087                                   \textcolor{keywordtype}{int} j,
00088                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00089                                   \textcolor{keywordtype}{int} *L,
00090                                   \textcolor{keywordtype}{int} l[3]);
00091 
00092 \textcolor{keywordtype}{void}
00093 get\_gquad\_pattern\_exhaustive( \textcolor{keywordtype}{short} *S,
00094                               \textcolor{keywordtype}{int} i,
00095                               \textcolor{keywordtype}{int} j,
00096                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00097                               \textcolor{keywordtype}{int} *L,
00098                               \textcolor{keywordtype}{int} *l,
00099                               \textcolor{keywordtype}{int} threshold);
00100 
00101 \textcolor{keywordtype}{void}        get\_gquad\_pattern\_pf( \textcolor{keywordtype}{short} *S,
00102                                   \textcolor{keywordtype}{int} i,
00103                                   \textcolor{keywordtype}{int} j,
00104                                   \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf,
00105                                   \textcolor{keywordtype}{int} *L,
00106                                   \textcolor{keywordtype}{int} l[3]);
00107 
00108 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_pr( \textcolor{keywordtype}{short} *S,
00109                                       \textcolor{keywordtype}{int} gi,
00110                                       \textcolor{keywordtype}{int} gj,
00111                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00112                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *probs,
00113                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00114                                       \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00115 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_pr\_max(\textcolor{keywordtype}{short} *S,
00116                                       \textcolor{keywordtype}{int} gi,
00117                                       \textcolor{keywordtype}{int} gj,
00118                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00119                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *probs,
00120                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00121                                       \textcolor{keywordtype}{int} *L,
00122                                       \textcolor{keywordtype}{int} l[3],
00123                                       \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00124 
00125 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_db( \textcolor{keyword}{const} \textcolor{keywordtype}{char} *structure,
00126                                       \textcolor{keywordtype}{float} \hyperlink{fold__vars_8h_ac98ec419070aee6831b44e5c700f090f}{pr});
00127 
00128 \textcolor{keywordtype}{int}         get\_gquad\_count(\textcolor{keywordtype}{short} *S,
00129                             \textcolor{keywordtype}{int} i,
00130                             \textcolor{keywordtype}{int} j);
00131 
00132 \textcolor{keywordtype}{int}         get\_gquad\_layer\_count(\textcolor{keywordtype}{short} *S,
00133                             \textcolor{keywordtype}{int} i,
00134                             \textcolor{keywordtype}{int} j);
00135 
00136 
00147 \textcolor{keywordtype}{int}         \hyperlink{group__loops_gae41763215b9c64d2a7b67f0df8a28078}{parse\_gquad}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *struc, \textcolor{keywordtype}{int} *L, \textcolor{keywordtype}{int} l[3]);
00148 
00149 INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int} c,
00150                                             \textcolor{keywordtype}{int} i,
00151                                             \textcolor{keywordtype}{int} j,
00152                                             \textcolor{keywordtype}{int} type,
00153                                             \textcolor{keywordtype}{short} *S,
00154                                             \textcolor{keywordtype}{int} *ggg,
00155                                             \textcolor{keywordtype}{int} *index,
00156                                             \textcolor{keywordtype}{int} *p,
00157                                             \textcolor{keywordtype}{int} *q,
00158                                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00159 
00160 INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int} c,
00161                                               \textcolor{keywordtype}{int} i,
00162                                               \textcolor{keywordtype}{int} j,
00163                                               \textcolor{keywordtype}{int} type,
00164                                               \textcolor{keywordtype}{short} *S,
00165                                               \textcolor{keywordtype}{int} **ggg,
00166                                               \textcolor{keywordtype}{int} maxdist,
00167                                               \textcolor{keywordtype}{int} *p,
00168                                               \textcolor{keywordtype}{int} *q,
00169                                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00170 
00171 PRIVATE INLINE \textcolor{keywordtype}{int}
00172 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00173                   \textcolor{keywordtype}{int} i,
00174                   \textcolor{keywordtype}{int} j,
00175                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00176                   \textcolor{keywordtype}{int} *stack\_count);
00177 
00178 PRIVATE INLINE \textcolor{keywordtype}{int}
00179 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00180                   \textcolor{keywordtype}{int} i,
00181                   \textcolor{keywordtype}{int} j,
00182                   \textcolor{keywordtype}{int} en,
00183                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00184                   \textcolor{keywordtype}{int} *stack\_count);
00185 
00186 PRIVATE INLINE \textcolor{keywordtype}{int}
00187 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00188                   \textcolor{keywordtype}{int} i,
00189                   \textcolor{keywordtype}{int} j,
00190                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00191                   \textcolor{keywordtype}{int} *stack\_count)\{
00192 
00193   \textcolor{comment}{/*}
00194 \textcolor{comment}{    here we do some fancy stuff to backtrace the stacksize and linker lengths}
00195 \textcolor{comment}{    of the g-quadruplex that should reside within position i,j}
00196 \textcolor{comment}{  */}
00197   \textcolor{keywordtype}{short}         *S;
00198   \textcolor{keywordtype}{int}           l[3], L, a;
00199   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00200 
00201   P = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00202   S = vc->sequence\_encoding2;
00203   L = -1;
00204 
00205   get\_gquad\_pattern\_mfe(S, i, j, P, &L, l);
00206 
00207   \textcolor{keywordflow}{if}(L != -1)\{
00208     \textcolor{comment}{/* fill the G's of the quadruplex into base\_pair2 */}
00209     \textcolor{keywordflow}{for}(a=0;a<L;a++)\{
00210       bp\_stack[++(*stack\_count)].i = i+a;
00211       bp\_stack[(*stack\_count)].j   = i+a;
00212       bp\_stack[++(*stack\_count)].i = i+L+l[0]+a;
00213       bp\_stack[(*stack\_count)].j   = i+L+l[0]+a;
00214       bp\_stack[++(*stack\_count)].i = i+L+l[0]+L+l[1]+a;
00215       bp\_stack[(*stack\_count)].j   = i+L+l[0]+L+l[1]+a;
00216       bp\_stack[++(*stack\_count)].i = i+L+l[0]+L+l[1]+L+l[2]+a;
00217       bp\_stack[(*stack\_count)].j   = i+L+l[0]+L+l[1]+L+l[2]+a;
00218     \}
00219     \textcolor{keywordflow}{return} 1;
00220   \} \textcolor{keywordflow}{else} \{
00221     \textcolor{keywordflow}{return} 0;
00222   \}
00223 \}
00224 
00225 PRIVATE INLINE \textcolor{keywordtype}{int}
00226 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00227                   \textcolor{keywordtype}{int} i,
00228                   \textcolor{keywordtype}{int} j,
00229                   \textcolor{keywordtype}{int} en,
00230                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00231                   \textcolor{keywordtype}{int} *stack\_count)\{
00232 
00233   \textcolor{keywordtype}{int}           energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, *idx, ij, p, q, maxl, minl, c0, l1, *rtype, *ggg;
00234   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type;
00235   \textcolor{keywordtype}{char}          *ptype;
00236   \textcolor{keywordtype}{short}         si, sj, *S, *S1;
00237 
00238   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00239   \hyperlink{group__model__details_structvrna__md__s}{vrna\_md\_t}     *md;
00240 
00241   idx         = vc->\hyperlink{group__fold__compound_a5037235dee512efd85ca543780bbca1a}{jindx};
00242   ij          = idx[j] + i;
00243   P           = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00244   md          = &(P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details});
00245   ptype       = vc->\hyperlink{group__fold__compound_a3fbea559f1d1976b2d67c215cdeee0b2}{ptype};
00246   rtype       = &(md->\hyperlink{group__model__details_ad082d0fea31e002b90cdfe5e6382f8b0}{rtype}[0]);
00247   type        = rtype[(\textcolor{keywordtype}{unsigned} char)ptype[ij]];
00248   S1          = vc->\hyperlink{group__fold__compound_a9934bdb695d35a3544285cbcc19f9763}{sequence\_encoding};
00249   S           = vc->sequence\_encoding2;
00250   dangles     = md->\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00251   si          = S1[i + 1];
00252   sj          = S1[j - 1];
00253   ggg         = vc->\hyperlink{group__fold__compound_aca8be7bdc65bafe2172c6ee777f18568}{matrices}->\hyperlink{group__dp__matrices_a0b7b86a5c75c96eabb89eb53a13e7164}{ggg};
00254   energy      = 0;
00255 
00256   \textcolor{keywordflow}{if}(dangles == 2)
00257     energy += P->mismatchI[type][si][sj];
00258 
00259   \textcolor{keywordflow}{if}(type > 2)
00260     energy += P->TerminalAU;
00261 
00262   p = i + 1;
00263   \textcolor{keywordflow}{if}(S1[p] == 3)\{
00264     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00265       minl  = j - i + p - \hyperlink{energy__const_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP} - 2;
00266       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00267       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00268       c0    = j - 3;
00269       maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00270       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00271       \textcolor{keywordflow}{for}(q = minl; q < maxl; q++)\{
00272         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00273         \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[j - q - 1])\{
00274           \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00275         \}
00276       \}
00277     \}
00278   \}
00279 
00280   \textcolor{keywordflow}{for}(p = i + 2;
00281       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00282       p++)\{
00283     l1    = p - i - 1;
00284     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00285     \textcolor{keywordflow}{if}(S1[p] != 3) \textcolor{keywordflow}{continue};
00286     minl  = j - i + p - MAXLOOP - 2;
00287     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00288     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00289     c0    = j - 1;
00290     maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00291     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00292     \textcolor{keywordflow}{for}(q = minl; q < maxl; q++)\{
00293       \textcolor{keywordflow}{if}(S1[q] != 3) \textcolor{keywordflow}{continue};
00294       \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[l1 + j - q - 1])\{
00295         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00296       \}
00297     \}
00298   \}
00299 
00300   q = j - 1;
00301   \textcolor{keywordflow}{if}(S1[q] == 3)
00302     \textcolor{keywordflow}{for}(p = i + 4;
00303         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00304         p++)\{
00305       l1    = p - i - 1;
00306       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00307       \textcolor{keywordflow}{if}(S1[p] != 3) \textcolor{keywordflow}{continue};
00308       \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[l1])\{
00309         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00310       \}
00311     \}
00312 
00313   \textcolor{keywordflow}{return} 0;
00314 \}
00315 
\hypertarget{gquad_8h_source_l00333}{}\hyperlink{group__loops_ga220c41e8dbcee940ac975b8ce88e55c5}{00333} INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int} c,
00334                                             \textcolor{keywordtype}{int} i,
00335                                             \textcolor{keywordtype}{int} j,
00336                                             \textcolor{keywordtype}{int} type,
00337                                             \textcolor{keywordtype}{short} *S,
00338                                             \textcolor{keywordtype}{int} *ggg,
00339                                             \textcolor{keywordtype}{int} *index,
00340                                             \textcolor{keywordtype}{int} *p,
00341                                             \textcolor{keywordtype}{int} *q,
00342                                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00343 
00344   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00345   \textcolor{keywordtype}{short} si, sj;
00346 
00347   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00348   si      = S[i + 1];
00349   sj      = S[j - 1];
00350   energy  = 0;
00351 
00352   \textcolor{keywordflow}{if}(dangles == 2)
00353     energy += P->mismatchI[type][si][sj];
00354 
00355   \textcolor{keywordflow}{if}(type > 2)
00356     energy += P->TerminalAU;
00357 
00358   k = i + 1;
00359   \textcolor{keywordflow}{if}(S[k] == 3)\{
00360     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00361       minl  = j - i + k - MAXLOOP - 2;
00362       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00363       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00364       c0    = j - 3;
00365       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00366       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00367       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00368         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00369         \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[j - l - 1])\{
00370           *p = k; *q = l;
00371           \textcolor{keywordflow}{return} 1;
00372         \}
00373       \}
00374     \}
00375   \}
00376 
00377   \textcolor{keywordflow}{for}(k = i + 2;
00378       k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00379       k++)\{
00380     l1    = k - i - 1;
00381     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00382     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00383     minl  = j - i + k - MAXLOOP - 2;
00384     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00385     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00386     c0    = j - 1;
00387     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00388     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00389     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00390       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00391       \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[l1 + j - l - 1])\{
00392         *p = k; *q = l;
00393         \textcolor{keywordflow}{return} 1;
00394       \}
00395     \}
00396   \}
00397 
00398   l = j - 1;
00399   \textcolor{keywordflow}{if}(S[l] == 3)
00400     \textcolor{keywordflow}{for}(k = i + 4;
00401         k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00402         k++)\{
00403       l1    = k - i - 1;
00404       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00405       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00406       \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[l1])\{
00407         *p = k; *q = l;
00408         \textcolor{keywordflow}{return} 1;
00409       \}
00410     \}
00411 
00412   \textcolor{keywordflow}{return} 0;
00413 \}
00414 
\hypertarget{gquad_8h_source_l00431}{}\hyperlink{group__loops_ga7b371308fa5a45c7ac353ef6ed1014de}{00431} INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__loops_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int} c,
00432                                               \textcolor{keywordtype}{int} i,
00433                                               \textcolor{keywordtype}{int} j,
00434                                               \textcolor{keywordtype}{int} type,
00435                                               \textcolor{keywordtype}{short} *S,
00436                                               \textcolor{keywordtype}{int} **ggg,
00437                                               \textcolor{keywordtype}{int} maxdist,
00438                                               \textcolor{keywordtype}{int} *p,
00439                                               \textcolor{keywordtype}{int} *q,
00440                                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00441 
00442   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00443   \textcolor{keywordtype}{short} si, sj;
00444 
00445   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00446   si      = S[i + 1];
00447   sj      = S[j - 1];
00448   energy  = 0;
00449 
00450   \textcolor{keywordflow}{if}(dangles == 2)
00451     energy += P->mismatchI[type][si][sj];
00452 
00453   \textcolor{keywordflow}{if}(type > 2)
00454     energy += P->TerminalAU;
00455 
00456   k = i + 1;
00457   \textcolor{keywordflow}{if}(S[k] == 3)\{
00458     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00459       minl  = j - i + k - MAXLOOP - 2;
00460       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00461       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00462       c0    = j - 3;
00463       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00464       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00465       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00466         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00467         \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[j - l - 1])\{
00468           *p = k; *q = l;
00469           \textcolor{keywordflow}{return} 1;
00470         \}
00471       \}
00472     \}
00473   \}
00474 
00475   \textcolor{keywordflow}{for}(k = i + 2;
00476       k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00477       k++)\{
00478     l1    = k - i - 1;
00479     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00480     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00481     minl  = j - i + k - MAXLOOP - 2;
00482     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00483     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minl);
00484     c0    = j - 1;
00485     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00486     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxl);
00487     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00488       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00489       \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[l1 + j - l - 1])\{
00490         *p = k; *q = l;
00491         \textcolor{keywordflow}{return} 1;
00492       \}
00493     \}
00494   \}
00495 
00496   l = j - 1;
00497   \textcolor{keywordflow}{if}(S[l] == 3)
00498     \textcolor{keywordflow}{for}(k = i + 4;
00499         k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00500         k++)\{
00501       l1    = k - i - 1;
00502       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00503       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00504       \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[l1])\{
00505         *p = k; *q = l;
00506         \textcolor{keywordflow}{return} 1;
00507       \}
00508     \}
00509 
00510   \textcolor{keywordflow}{return} 0;
00511 \}
00512 
00513 PRIVATE INLINE
00514 \textcolor{keywordtype}{int}
00515 E\_GQuad\_IntLoop(\textcolor{keywordtype}{int} i,
00516                 \textcolor{keywordtype}{int} j,
00517                 \textcolor{keywordtype}{int} type,
00518                 \textcolor{keywordtype}{short} *S,
00519                 \textcolor{keywordtype}{int} *ggg,
00520                 \textcolor{keywordtype}{int} *index,
00521                 \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00522 
00523   \textcolor{keywordtype}{int} energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00524   \textcolor{keywordtype}{short} si, sj;
00525 
00526   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00527   si      = S[i + 1];
00528   sj      = S[j - 1];
00529   energy  = 0;
00530 
00531   \textcolor{keywordflow}{if}(dangles == 2)
00532     energy += P->mismatchI[type][si][sj];
00533 
00534   \textcolor{keywordflow}{if}(type > 2)
00535     energy += P->TerminalAU;
00536 
00537   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00538 
00539   p = i + 1;
00540   \textcolor{keywordflow}{if}(S[p] == 3)\{
00541     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00542       minq  = j - i + p - MAXLOOP - 2;
00543       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00544       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00545       c0    = j - 3;
00546       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00547       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00548       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00549         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00550         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00551         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00552       \}
00553     \}
00554   \}
00555 
00556   \textcolor{keywordflow}{for}(p = i + 2;
00557       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00558       p++)\{
00559     l1    = p - i - 1;
00560     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00561     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00562     minq  = j - i + p - MAXLOOP - 2;
00563     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00564     minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00565     c0    = j - 1;
00566     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00567     maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00568     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00569       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00570       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00571       ge   = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00572     \}
00573   \}
00574 
00575   q = j - 1;
00576   \textcolor{keywordflow}{if}(S[q] == 3)
00577     \textcolor{keywordflow}{for}(p = i + 4;
00578         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00579         p++)\{
00580       l1    = p - i - 1;
00581       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00582       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00583       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00584       ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00585     \}
00586 
00587 \textcolor{preprocessor}{#if 0}
00588   \textcolor{comment}{/* here comes the additional stuff for the odd dangle models */}
00589   \textcolor{keywordflow}{if}(dangles % 1)\{
00590     en1 = energy + P->dangle5[type][si];
00591     en2 = energy + P->dangle5[type][sj];
00592     en3 = energy + P->mismatchI[type][si][sj];
00593 
00594     \textcolor{comment}{/* first case with 5' dangle (i.e. j-1) onto enclosing pair */}
00595     p = i + 1;
00596     \textcolor{keywordflow}{if}(S[p] == 3)\{
00597       \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00598         minq  = j - i + p - MAXLOOP - 2;
00599         c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00600         minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00601         c0    = j - 4;
00602         maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00603         maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00604         \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00605           \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00606           c0  = en1 + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00607           ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00608         \}
00609       \}
00610     \}
00611 
00612     \textcolor{keywordflow}{for}(p = i + 2; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++)\{
00613       l1    = p - i - 1;
00614       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00615       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00616       minq  = j - i + p - MAXLOOP - 2;
00617       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00618       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00619       c0    = j - 2;
00620       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00621       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00622       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00623         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00624         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00625         ge   = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00626       \}
00627     \}
00628 
00629     q = j - 2;
00630     \textcolor{keywordflow}{if}(S[q] == 3)
00631       \textcolor{keywordflow}{for}(p = i + 4; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++)\{
00632         l1    = p - i - 1;
00633         \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00634         \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00635         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + 1];
00636         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00637       \}
00638 
00639     \textcolor{comment}{/* second case with 3' dangle (i.e. i+1) onto enclosing pair */}
00640 
00641   \}
00642 \textcolor{preprocessor}{#endif}
00643   \textcolor{keywordflow}{return} ge;
00644 \}
00645 
00646 PRIVATE INLINE
00647 \textcolor{keywordtype}{int} *
00648 E\_GQuad\_IntLoop\_exhaustive( \textcolor{keywordtype}{int} i,
00649                             \textcolor{keywordtype}{int} j,
00650                             \textcolor{keywordtype}{int} **p\_p,
00651                             \textcolor{keywordtype}{int} **q\_p,
00652                             \textcolor{keywordtype}{int} type,
00653                             \textcolor{keywordtype}{short} *S,
00654                             \textcolor{keywordtype}{int} *ggg,
00655                             \textcolor{keywordtype}{int} threshold,
00656                             \textcolor{keywordtype}{int} *index,
00657                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00658 
00659   \textcolor{keywordtype}{int} energy, *ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00660   \textcolor{keywordtype}{short} si, sj;
00661   \textcolor{keywordtype}{int} cnt = 0;
00662 
00663   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00664   si      = S[i + 1];
00665   sj      = S[j - 1];
00666   energy  = 0;
00667 
00668   \textcolor{keywordflow}{if}(dangles == 2)
00669     energy += P->mismatchI[type][si][sj];
00670 
00671   \textcolor{keywordflow}{if}(type > 2)
00672     energy += P->TerminalAU;
00673 
00674   \textcolor{comment}{/* guess how many gquads are possible in interval [i+1,j-1] */}
00675   *p\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00676   *q\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00677   ge    = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00678 
00679   p = i + 1;
00680   \textcolor{keywordflow}{if}(S[p] == 3)\{
00681     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00682       minq  = j - i + p - MAXLOOP - 2;
00683       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00684       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00685       c0    = j - 3;
00686       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00687       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00688       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00689         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00690         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00691         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00692           ge[cnt]       = energy + P->internal\_loop[j - q - 1];
00693           (*p\_p)[cnt]   = p;
00694           (*q\_p)[cnt++] = q;
00695         \}
00696       \}
00697     \}
00698   \}
00699 
00700   \textcolor{keywordflow}{for}(p = i + 2;
00701       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00702       p++)\{
00703     l1    = p - i - 1;
00704     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00705     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00706     minq  = j - i + p - MAXLOOP - 2;
00707     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00708     minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00709     c0    = j - 1;
00710     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00711     maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00712     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00713       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00714       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00715         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00716           ge[cnt]       = energy + P->internal\_loop[l1 + j - q - 1];
00717           (*p\_p)[cnt]   = p;
00718           (*q\_p)[cnt++] = q;
00719         \}
00720     \}
00721   \}
00722 
00723   q = j - 1;
00724   \textcolor{keywordflow}{if}(S[q] == 3)
00725     \textcolor{keywordflow}{for}(p = i + 4;
00726         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00727         p++)\{
00728       l1    = p - i - 1;
00729       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00730       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00731       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00732         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00733           ge[cnt]       = energy + P->internal\_loop[l1];
00734           (*p\_p)[cnt]   = p;
00735           (*q\_p)[cnt++] = q;
00736         \}
00737     \}
00738 
00739 
00740   (*p\_p)[cnt] = -1;
00741 
00742   \textcolor{keywordflow}{return} ge;
00743 \}
00744 
00745 PRIVATE INLINE
00746 \textcolor{keywordtype}{int}
00747 E\_GQuad\_IntLoop\_L(\textcolor{keywordtype}{int} i,
00748                   \textcolor{keywordtype}{int} j,
00749                   \textcolor{keywordtype}{int} type,
00750                   \textcolor{keywordtype}{short} *S,
00751                   \textcolor{keywordtype}{int} **ggg,
00752                   \textcolor{keywordtype}{int} maxdist,
00753                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00754 
00755   \textcolor{keywordtype}{int} energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00756   \textcolor{keywordtype}{short} si, sj;
00757 
00758   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00759   si      = S[i + 1];
00760   sj      = S[j - 1];
00761   energy  = 0;
00762 
00763   \textcolor{keywordflow}{if}(dangles == 2)
00764     energy += P->mismatchI[type][si][sj];
00765 
00766   \textcolor{keywordflow}{if}(type > 2)
00767     energy += P->TerminalAU;
00768 
00769   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00770 
00771   p = i + 1;
00772   \textcolor{keywordflow}{if}(S[p] == 3)\{
00773     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00774       minq  = j - i + p - MAXLOOP - 2;
00775       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00776       minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00777       c0    = j - 3;
00778       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00779       maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00780       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00781         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00782         c0  = energy + ggg[p][q-p] + P->internal\_loop[j - q - 1];
00783         ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00784       \}
00785     \}
00786   \}
00787 
00788   \textcolor{keywordflow}{for}(p = i + 2;
00789       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00790       p++)\{
00791     l1    = p - i - 1;
00792     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00793     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00794     minq  = j - i + p - MAXLOOP - 2;
00795     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00796     minq  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(c0, minq);
00797     c0    = j - 1;
00798     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00799     maxq  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(c0, maxq);
00800     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00801       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00802       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1 + j - q - 1];
00803       ge   = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00804     \}
00805   \}
00806 
00807   q = j - 1;
00808   \textcolor{keywordflow}{if}(S[q] == 3)
00809     \textcolor{keywordflow}{for}(p = i + 4;
00810         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00811         p++)\{
00812       l1    = p - i - 1;
00813       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00814       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00815       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1];
00816       ge  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(ge, c0);
00817     \}
00818 
00819   \textcolor{keywordflow}{return} ge;
00820 \}
00821 
00822 PRIVATE INLINE
00823 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}
00824 exp\_E\_GQuad\_IntLoop(\textcolor{keywordtype}{int} i,
00825                     \textcolor{keywordtype}{int} j,
00826                     \textcolor{keywordtype}{int} type,
00827                     \textcolor{keywordtype}{short} *S,
00828                     \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00829                     \textcolor{keywordtype}{int} *index,
00830                     \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf)\{
00831 
00832   \textcolor{keywordtype}{int}         k, l, minl, maxl, u, r;
00833   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  q, qe;
00834   \textcolor{keywordtype}{double}      *expintern;
00835   \textcolor{keywordtype}{short}       si, sj;
00836 
00837   q         = 0;
00838   si        = S[i + 1];
00839   sj        = S[j - 1];
00840   qe        = (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expmismatchI[type][si][sj];
00841   expintern = pf->expinternal;
00842 
00843   \textcolor{keywordflow}{if}(type > 2)
00844     qe *= (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expTermAU;
00845 
00846   k = i + 1;
00847   \textcolor{keywordflow}{if}(S[k] == 3)\{
00848     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00849       minl  = j - i + k - MAXLOOP - 2;
00850       u     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00851       minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(u, minl);
00852       u     = j - 3;
00853       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00854       maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(u, maxl);
00855       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00856         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00857         \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00858         q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[j - l - 1];
00859       \}
00860     \}
00861   \}
00862 
00863 
00864   \textcolor{keywordflow}{for}(k = i + 2;
00865       k <= j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00866       k++)\{
00867     u = k - i - 1;
00868     \textcolor{keywordflow}{if}(u > MAXLOOP) \textcolor{keywordflow}{break};
00869     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00870     minl  = j - i + k - MAXLOOP - 2;
00871     r     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00872     minl  = \hyperlink{group__utils_ga33297b3679c713b0c4d897cd0fe3b122}{MAX2}(r, minl);
00873     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00874     r     = j - 1;
00875     maxl  = \hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}(r, maxl);
00876     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00877       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00878       \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00879       q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u + j - l - 1];
00880     \}
00881   \}
00882 
00883   l = j - 1;
00884   \textcolor{keywordflow}{if}(S[l] == 3)
00885     \textcolor{keywordflow}{for}(k = i + 4; k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; k++)\{
00886       u    = k - i - 1;
00887       \textcolor{keywordflow}{if}(u>MAXLOOP) \textcolor{keywordflow}{break};
00888       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00889       \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00890       q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u];
00891     \}
00892 
00893   \textcolor{keywordflow}{return} q;
00894 \}
00895 
00901 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
